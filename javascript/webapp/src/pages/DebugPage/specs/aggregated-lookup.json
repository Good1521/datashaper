{
	"$schema": "../../../../../../schema/workflow.json",
	"name": "Aggregated lookup",
	"description": "Uses a multi-step aggregate and filter to do a custom lookup.",
	"steps": [
		{
			"id": "join-1",
			"verb": "join",
			"inputs": {
				"default": { "node": "data/companies.csv" },
				"other": { "node": "data/products.csv" }
			},
			"outputs": { "default": "join-1" },
			"args": {
				"on": ["ID"]
			}
		},
		{
			"id": "filter-1",
			"verb": "filter",
			"inputs": { "default": { "node": "join-1" } },
			"outputs": { "default": "filter-1" },
			"args": {
				"column": "FY21 Sales",
				"criteria": [
					{
						"value": 10000,
						"operator": ">=",
						"type": "value"
					}
				]
			}
		},
		{
			"id": "aggregate-1",
			"verb": "aggregate",
			"inputs": { "default": { "node": "filter-1" } },
			"outputs": { "default": "aggregate-1" },
			"args": {
				"groupby": "ID",
				"column": "FY21 Sales",
				"operation": "sum",
				"to": "Total sales >= 10k"
			}
		},
		{
			"id": "lookup-1",
			"verb": "lookup",
			"inputs": {
				"default": { "node": "data/companies.csv" },
				"other": { "node": "aggregate-1" }
			},
			"outputs": { "default": "lookup-1" },
			"args": {
				"on": ["ID"],
				"columns": ["Total sales >= 10k"]
			}
		}
	]
}
